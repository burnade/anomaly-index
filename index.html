<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>이변 목록 정리</title>
  <style><!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>이변 목록 정리</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 40px;
      background-color: #121212;
      color: #e0e0e0;
    }
    h1, h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #444;
      text-align: left;
    }
    th {
      background-color: #222;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #1e1e1e;
    }
    .section {
      margin-top: 30px;
    }
    label, input, textarea, select {
      display: block;
      margin-bottom: 10px;
      width: 100%;
      background-color: #222;
      color: white;
      border: 1px solid #555;
    }
    button {
      padding: 10px 20px;
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
      margin-right: 10px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="mainScreen">
    <h1>이변 관리 시스템</h1>
    <div style="text-align:center">
      <button onclick="goToAnomalyList()">이변 목록 보기</button>
    </div>
  </div>

  <div id="anomalyScreen" class="hidden">
    <h1>이변 목록</h1>

    <div class="section">
      <label>분류 필터:
        <select id="filterType" onchange="renderTable()">
        </select>
      </label>
    </div>

    <table id="anomalyTable">
      <thead>
        <tr>
          <th>코드</th>
          <th>격리 등급</th>
          <th>위험 등급</th>
          <th>설명</th>
          <th>수정</th>
          <th>삭제</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="section">
      <h2 id="formTitle">새 이변 추가</h2>
      <label>코드 (예: A-001): <input type="text" id="code"></label>
      <label>격리 등급 (0~6): <input type="number" id="isolation" min="0" max="6"></label>
      <label>위험 등급 (0~6): <input type="number" id="threat" min="0" max="6"></label>
      <label>설명:
        <textarea id="description" rows="4"></textarea>
      </label>
      <button id="submitBtn" onclick="addEntry()">이변 추가</button>
      <button id="cancelEditBtn" onclick="cancelEdit()" style="display:none">취소</button>
    </div>

    <div class="section">
      <h2>분류 관리</h2>
      <label>새 분류 추가: <input type="text" id="newType"></label>
      <button onclick="addType()">추가</button>
      <label>분류 삭제: <select id="deleteType"></select></label>
      <button onclick="deleteType()">삭제</button>
    </div>
  </div>

  <script>
    let editIndex = null;
    let types = JSON.parse(localStorage.getItem("types")) || ["A", "R", "H"];

    function saveData(data) {
      localStorage.setItem("anomalies", JSON.stringify(data));
    }

    function loadData() {
      return JSON.parse(localStorage.getItem("anomalies")) || [];
    }

    function saveTypes() {
      localStorage.setItem("types", JSON.stringify(types));
    }

    function renderTypeDropdowns() {
      const filterSelect = document.getElementById("filterType");
      const deleteSelect = document.getElementById("deleteType");
      filterSelect.innerHTML = `<option value="">전체</option>`;
      deleteSelect.innerHTML = "";
      types.forEach(type => {
        filterSelect.innerHTML += `<option value="${type}">${type}</option>`;
        deleteSelect.innerHTML += `<option value="${type}">${type}</option>`;
      });
    }

    function renderTable() {
      renderTypeDropdowns();
      const table = document.getElementById("anomalyTable").getElementsByTagName("tbody")[0];
      table.innerHTML = "";
      const filter = document.getElementById("filterType").value;
      const data = loadData();
      data.forEach((entry, index) => {
        if (!filter || entry.code.startsWith(filter)) {
          const row = table.insertRow();
          row.insertCell(0).innerText = entry.code;
          const isoCell = row.insertCell(1);
          isoCell.innerText = entry.isolation;
          isoCell.style.color = getLevelColor(entry.isolation);
          const thrCell = row.insertCell(2);
          thrCell.innerText = entry.threat;
          thrCell.style.color = getLevelColor(entry.threat);
          row.insertCell(3).innerText = entry.description;

          const editCell = row.insertCell(4);
          const editButton = document.createElement("button");
          editButton.innerText = "수정";
          editButton.onclick = () => startEdit(index);
          editCell.appendChild(editButton);

          const deleteCell = row.insertCell(5);
          const deleteButton = document.createElement("button");
          deleteButton.innerText = "삭제";
          deleteButton.onclick = () => deleteEntry(index);
          deleteCell.appendChild(deleteButton);
        }
      });
    }

    function getLevelColor(level) {
      const lvl = parseInt(level);
      if (lvl >= 5) return "#ff6b6b";
      if (lvl >= 3) return "#ffa502";
      return "#70a1ff";
    }

    function addEntry() {
      const code = document.getElementById("code").value;
      const isolation = document.getElementById("isolation").value;
      const threat = document.getElementById("threat").value;
      const description = document.getElementById("description").value;
      const data = loadData();

      if (editIndex !== null) {
        data[editIndex] = { code, isolation, threat, description };
        editIndex = null;
        document.getElementById("formTitle").innerText = "새 이변 추가";
        document.getElementById("submitBtn").innerText = "이변 추가";
        document.getElementById("cancelEditBtn").style.display = "none";
      } else {
        data.push({ code, isolation, threat, description });
      }

      saveData(data);
      renderTable();
      document.getElementById("code").value = "";
      document.getElementById("isolation").value = "";
      document.getElementById("threat").value = "";
      document.getElementById("description").value = "";
    }

    function startEdit(index) {
      const data = loadData();
      const entry = data[index];
      document.getElementById("code").value = entry.code;
      document.getElementById("isolation").value = entry.isolation;
      document.getElementById("threat").value = entry.threat;
      document.getElementById("description").value = entry.description;
      editIndex = index;
      document.getElementById("formTitle").innerText = "이변 수정";
      document.getElementById("submitBtn").innerText = "수정 저장";
      document.getElementById("cancelEditBtn").style.display = "inline-block";
    }

    function cancelEdit() {
      editIndex = null;
      document.getElementById("code").value = "";
      document.getElementById("isolation").value = "";
      document.getElementById("threat").value = "";
      document.getElementById("description").value = "";
      document.getElementById("formTitle").innerText = "새 이변 추가";
      document.getElementById("submitBtn").innerText = "이변 추가";
      document.getElementById("cancelEditBtn").style.display = "none";
    }

    function deleteEntry(index) {
      const data = loadData();
      if (confirm("정말로 이 이변을 삭제하시겠습니까?")) {
        data.splice(index, 1);
        saveData(data);
        renderTable();
      }
    }

    function addType() {
      const newType = document.getElementById("newType").value.trim();
      if (newType && !types.includes(newType)) {
        types.push(newType);
        saveTypes();
        renderTypeDropdowns();
        document.getElementById("newType").value = "";
      }
    }

    function deleteType() {
      const selected = document.getElementById("deleteType").value;
      types = types.filter(t => t !== selected);
      saveTypes();
      renderTypeDropdowns();
    }

    function goToAnomalyList() {
      document.getElementById("mainScreen").classList.add("hidden");
      document.getElementById("anomalyScreen").classList.remove("hidden");
      renderTable();
    }

    window.onload = renderTypeDropdowns;
  </script>
</body>
</html>
